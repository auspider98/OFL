<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="OFC — The Playas. Meet the members of the Official Fantasy Commission." />
  <title>OFL — Playas</title>
  <link rel="icon" type="image/png" href="assets/favicon.png" />
  <link rel="stylesheet" href="style.css" />
  <script src="admin-config.js"></script>
  <script src="admin.js"></script>

  <style>
    /* ── Playas page layout ─────────────────────────────────── */
    .playas-page {
      position: relative;
      width: 100%;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }

    .playas-page > .slide-layer      { position: fixed; inset: 0; z-index: 0; height: 100%; }
    .playas-page > .landing-overlay  { position: fixed; inset: 0; z-index: 10; height: 100%; pointer-events: none; }
    .playas-page > .landing-vignette { position: fixed; inset: 0; z-index: 11; height: 100%; pointer-events: none; }

    /* ── Hero ─────────────────────────────────────────────── */
    .playas-hero {
      position: relative;
      z-index: 20;
      width: 100%;
      min-height: calc(32vh - 10px);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 5rem 2rem 2rem;
    }
    .playas-hero .landing-rule { position: absolute; bottom: 0; left: 0; right: 0; z-index: 10; }
    .playas-hero-content {
      position: relative; z-index: 13; text-align: center;
      animation: heroReveal 1.4s ease forwards; opacity: 0;
    }
    .playas-hero-eyebrow {
      font-family: var(--font-body); font-weight: 300;
      font-size: var(--size-eyebrow, 8pt); letter-spacing: 0.45em;
      text-transform: uppercase; color: var(--accent-dim); margin-bottom: 1rem;
      opacity: 0; animation: heroReveal 1.2s 0.2s ease forwards;
    }
    .playas-hero-title {
      font-family: var(--font-display); font-weight: 300;
      font-size: var(--size-title, 72pt); line-height: 0.92;
      letter-spacing: -0.02em; color: var(--accent); margin-bottom: 1rem;
      opacity: 0; animation: heroReveal 1.2s 0.4s ease forwards;
    }
    .playas-hero-subtitle {
      font-family: var(--font-body); font-weight: 200;
      font-size: var(--size-subtitle, 10pt); letter-spacing: 0.35em;
      text-transform: uppercase; color: var(--accent-dim);
      opacity: 0; animation: heroReveal 1.2s 0.55s ease forwards;
    }

    /* ── Body ─────────────────────────────────────────────── */
    .playas-body { position: relative; z-index: 20; flex: 1; padding: 0 0 5rem; }
    .playas-section { max-width: 1040px; margin: 0 auto; padding: 1.5rem 2rem 0; }
    .playas-section-heading {
      font-family: var(--font-body); font-weight: var(--weight-section-heading, 300);
      font-size: var(--size-section-heading, 7pt); letter-spacing: 0.4em;
      text-transform: uppercase; color: var(--hint-color, var(--accent-dim));
      margin-bottom: 1.4rem; padding-bottom: 0.6rem;
      border-bottom: 1px solid var(--drawer-border);
    }

    /* ── Member Grid ──────────────────────────────────────── */
    .playas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 1.5rem;
    }

    /* ── Flip card wrapper ────────────────────────────────── */
    .playa-card {
      perspective: 1000px;
      cursor: pointer;
      height: 440px;
    }
    .playa-card.is-inactive { opacity: 0.45; }
    .playa-card-inner {
      position: relative; width: 100%; height: 100%;
      transition: transform 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      transform-style: preserve-3d;
    }
    .playa-card.is-flipped .playa-card-inner { transform: rotateY(180deg); }

    /* ── Front & Back shared ──────────────────────────────── */
    .playa-front,
    .playa-back {
      position: absolute; inset: 0;
      backface-visibility: hidden;
      -webkit-backface-visibility: hidden;
      background: rgba(255,255,255,0.02);
      border: 1px solid var(--drawer-border);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      display: flex; flex-direction: column; overflow: hidden;
      transition: border-color var(--transition);
    }
    .playa-front::before, .playa-back::before {
      content: ''; position: absolute; inset: 0;
      background: var(--accent-glow); opacity: 0;
      transition: opacity var(--transition); pointer-events: none; z-index: 0;
    }
    .playa-card:hover .playa-front,
    .playa-card:hover .playa-back { border-color: rgba(232,232,232,0.25); }
    .playa-card:hover .playa-front::before,
    .playa-card:hover .playa-back::before { opacity: 1; }
    .playa-back { transform: rotateY(180deg); overflow-y: auto; }

    /* ── Mugshot ──────────────────────────────────────────── */
    .playa-mugshot-wrap {
      width: 100%; aspect-ratio: 4 / 3; overflow: hidden;
      background: rgba(255,255,255,0.03); flex-shrink: 0; position: relative;
    }
    .playa-mugshot-wrap img {
      width: 100%; height: 100%; object-fit: cover;
      object-position: top center; display: block;
      transition: transform 0.5s ease; position: relative; z-index: 1;
    }
    .playa-card:hover .playa-mugshot-wrap img { transform: scale(1.04); }
    .playa-mugshot-placeholder {
      width: 100%; height: 100%; display: flex;
      align-items: center; justify-content: center;
    }
    .playa-monogram {
      font-family: var(--font-display); font-weight: 300; font-size: 4rem;
      color: var(--accent-dim); letter-spacing: -0.02em; line-height: 1; opacity: 0.6;
    }

    /* Status badge */
    .playa-status-badge {
      position: absolute; top: 0.65rem; left: 0.65rem;
      font-family: var(--font-body); font-size: 0.46rem;
      letter-spacing: 0.2em; text-transform: uppercase;
      padding: 0.18rem 0.45rem; border: 1px solid;
      backdrop-filter: blur(4px); z-index: 2;
    }
    .playa-status-badge.active {
      color: var(--hint-color, var(--accent-dim));
      border-color: var(--hint-color, var(--accent-dim));
      background: rgba(0,0,0,0.4);
    }
    .playa-status-badge.inactive {
      color: var(--accent-dim); border-color: var(--drawer-border);
      background: rgba(0,0,0,0.4);
    }

    /* Flip hint */
    .playa-flip-hint {
      position: absolute; bottom: 0.55rem; right: 0.7rem;
      font-family: var(--font-body); font-size: 0.46rem;
      letter-spacing: 0.18em; text-transform: uppercase;
      color: var(--accent-dim); opacity: 0.45; z-index: 2;
    }

    /* ── Front info area ──────────────────────────────────── */
    .playa-front-info {
      position: relative; z-index: 1;
      padding: 0.75rem 0.9rem 0.5rem;
      flex: 1; display: flex; flex-direction: column;
    }
    .playa-name-row {
      display: flex; align-items: flex-start;
      justify-content: space-between; gap: 0.5rem; margin-bottom: 0.15rem;
    }
    .playa-name {
      font-family: var(--font-display); font-weight: 300;
      font-size: 1.4rem; line-height: 1; letter-spacing: -0.01em;
      color: var(--accent); flex: 1; min-width: 0;
    }
    .playa-nickname {
      font-family: var(--font-body); font-weight: 300;
      font-size: 0.58rem; letter-spacing: 0.28em;
      text-transform: uppercase; color: var(--hint-color, var(--accent-dim));
      margin-bottom: 0.6rem;
    }

    /* ── League badges ────────────────────────────────────── */
    .playa-league-badges {
      display: flex; flex-direction: row;
      gap: 0.25rem; align-items: flex-start; flex-shrink: 0;
    }
    .playa-league-badge {
      display: flex; align-items: center; justify-content: center;
      width: 26px; height: 26px;
      border: 1px solid var(--drawer-border);
      background: rgba(0,0,0,0.3); overflow: hidden; flex-shrink: 0;
    }
    .playa-league-badge img { width: 20px; height: 20px; object-fit: contain; }
    .playa-league-badge-text {
      font-family: var(--font-body); font-size: 0.38rem; font-weight: 600;
      letter-spacing: 0.04em; text-transform: uppercase;
      color: var(--accent-dim); text-align: center; line-height: 1; padding: 0 2px;
    }

    /* ── Front league entries ─────────────────────────────── */
    .playa-leagues {
      display: flex; flex-direction: column; gap: 0.45rem;
      border-top: 1px solid var(--drawer-border);
      padding-top: 0.6rem; margin-top: 0.1rem;
    }
    .playa-league-entry { display: flex; flex-direction: column; gap: 0.12rem; }
    .playa-league-key {
      font-family: var(--font-body); font-size: 0.5rem;
      letter-spacing: 0.32em; text-transform: uppercase;
      color: var(--hint-color, var(--accent-dim));
    }
    .playa-league-teams { display: flex; flex-wrap: wrap; gap: 0.2rem 0.65rem; }
    .playa-team-item { display: flex; align-items: center; gap: 0.3rem; }
    .playa-team-logo { width: 16px; height: 16px; object-fit: contain; }
    .playa-team-name {
      font-family: var(--font-body); font-size: 0.68rem;
      color: var(--accent); font-weight: 300;
    }

    /* ── Recent awards on front ───────────────────────────── */
    .playa-recent-awards {
      display: flex; gap: 0.5rem;
      margin-top: auto; padding-top: 0.55rem;
      border-top: 1px solid var(--drawer-border);
    }
    .playa-recent-award-item {
      display: flex; align-items: center; gap: 0.3rem; flex: 1; min-width: 0;
    }
    .playa-recent-award-img {
      width: 22px; height: 22px; object-fit: contain; flex-shrink: 0;
    }
    .playa-recent-award-placeholder {
      width: 22px; height: 22px; display: flex;
      align-items: center; justify-content: center;
      border: 1px solid var(--drawer-border); flex-shrink: 0;
      font-size: 0.55rem; color: var(--accent-dim);
    }
    .playa-recent-award-name {
      font-family: var(--font-body); font-size: 0.52rem;
      letter-spacing: 0.04em; color: var(--accent-dim); line-height: 1.2;
      overflow: hidden; display: -webkit-box;
      -webkit-line-clamp: 2; -webkit-box-orient: vertical;
    }

    /* ── Stats strip ──────────────────────────────────────── */
    .playa-stats-strip {
      display: flex; gap: 1.5rem;
      padding: 0.5rem 0.9rem 1.6rem;
      border-top: 1px solid var(--drawer-border);
      position: relative; z-index: 1;
    }
    .playa-stat { display: flex; flex-direction: column; gap: 0.1rem; }
    .playa-stat-value {
      font-family: var(--font-display); font-weight: 300;
      font-size: 1.25rem; line-height: 1; color: var(--accent);
    }
    .playa-stat-label {
      font-family: var(--font-body); font-size: 0.46rem;
      letter-spacing: 0.25em; text-transform: uppercase; color: var(--accent-dim);
    }

    /* ── Back of card ─────────────────────────────────────── */
    .playa-back-inner {
      position: relative; z-index: 1;
      display: flex; flex-direction: column; height: 100%;
    }
    .playa-back-header {
      padding: 0.85rem 0.9rem 0.65rem;
      border-bottom: 1px solid var(--drawer-border);
      flex-shrink: 0; display: flex;
      align-items: flex-start; justify-content: space-between;
    }
    .playa-back-name-group { flex: 1; min-width: 0; }
    .playa-back-name {
      font-family: var(--font-display); font-weight: 300;
      font-size: 1.3rem; line-height: 1; color: var(--accent); margin-bottom: 0.2rem;
    }
    .playa-back-nickname {
      font-family: var(--font-body); font-weight: 300;
      font-size: 0.56rem; letter-spacing: 0.28em;
      text-transform: uppercase; color: var(--hint-color, var(--accent-dim));
    }
    .playa-back-close {
      font-size: 0.75rem; color: var(--accent-dim); opacity: 0.55;
      flex-shrink: 0; margin-left: 0.5rem; margin-top: 0.1rem; line-height: 1;
    }
    .playa-back-scroll {
      flex: 1; overflow-y: auto; padding: 0.75rem 0.9rem;
      display: flex; flex-direction: column; gap: 0.9rem;
    }
    .playa-back-section-label {
      font-family: var(--font-body); font-size: 0.48rem;
      letter-spacing: 0.35em; text-transform: uppercase;
      color: var(--hint-color, var(--accent-dim)); margin-bottom: 0.35rem;
    }

    /* League entries on back */
    .playa-back-leagues { display: flex; flex-direction: column; gap: 0.45rem; }
    .playa-back-league-entry { display: flex; flex-direction: column; gap: 0.12rem; }
    .playa-back-league-key {
      font-family: var(--font-body); font-size: 0.5rem;
      letter-spacing: 0.3em; text-transform: uppercase; color: var(--accent-dim);
    }
    .playa-back-teams { display: flex; flex-wrap: wrap; gap: 0.2rem 0.65rem; }
    .playa-back-team-item { display: flex; align-items: center; gap: 0.28rem; }
    .playa-back-team-logo { width: 15px; height: 15px; object-fit: contain; }
    .playa-back-team-name {
      font-family: var(--font-body); font-size: 0.65rem;
      color: var(--accent); font-weight: 300;
    }

    /* Championship years */
    .playa-back-champ-years { display: flex; flex-wrap: wrap; gap: 0.3rem; }
    .playa-back-champ-year {
      font-family: var(--font-body); font-size: 0.52rem; letter-spacing: 0.1em;
      color: var(--hint-color, var(--accent-dim));
      border: 1px solid var(--drawer-border); padding: 0.14rem 0.38rem;
    }

    /* Awards on back */
    .playa-back-awards { display: flex; flex-direction: column; gap: 0.45rem; }
    .playa-back-award-row { display: flex; align-items: center; gap: 0.5rem; }
    .playa-back-award-img { width: 26px; height: 26px; object-fit: contain; flex-shrink: 0; }
    .playa-back-award-placeholder {
      width: 26px; height: 26px; display: flex;
      align-items: center; justify-content: center;
      border: 1px solid var(--drawer-border);
      font-size: 0.65rem; color: var(--accent-dim); flex-shrink: 0;
    }
    .playa-back-award-info { display: flex; flex-direction: column; gap: 0.08rem; flex: 1; min-width: 0; }
    .playa-back-award-name {
      font-family: var(--font-body); font-size: 0.62rem;
      letter-spacing: 0.04em; color: var(--accent); font-weight: 300;
    }
    .playa-back-award-detail {
      font-family: var(--font-body); font-size: 0.5rem;
      letter-spacing: 0.06em; color: var(--accent-dim);
    }

    /* ── Controls row ────────────────────────────────────────── */
    .playas-controls-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1.4rem;
      padding-bottom: 0.6rem;
      border-bottom: 1px solid var(--drawer-border);
      flex-wrap: wrap;
    }
    .playas-controls-left {
      display: flex;
      align-items: baseline;
      gap: 0.4rem;
    }
    .playas-heading-text {
      font-family: var(--font-body);
      font-weight: var(--weight-section-heading, 300);
      font-size: var(--size-section-heading, 7pt);
      letter-spacing: 0.4em;
      text-transform: uppercase;
      color: var(--hint-color, var(--accent-dim));
    }
    .playas-heading-count {
      font-family: var(--font-body);
      font-size: var(--size-section-heading, 7pt);
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: var(--accent-dim);
      opacity: 0.6;
    }
    .playas-controls-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .playas-control-group {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }
    .playas-control-label {
      font-family: var(--font-body);
      font-size: 0.48rem;
      letter-spacing: 0.28em;
      text-transform: uppercase;
      color: var(--accent-dim);
      opacity: 0.6;
      white-space: nowrap;
    }
    .playas-select {
      font-family: var(--font-body);
      font-size: 0.55rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--accent);
      background: rgba(0,0,0,0.35);
      border: 1px solid var(--drawer-border);
      padding: 0.28rem 0.5rem;
      cursor: pointer;
      outline: none;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='5' viewBox='0 0 8 5'%3E%3Cpath fill='%23888' d='M0 0l4 5 4-5z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.4rem center;
      padding-right: 1.2rem;
    }
    .playas-select:focus { border-color: var(--accent-dim); }
    .playas-select option { background: #111; color: var(--accent); }

    /* ── Footer ─────────────────────────────────────────────── */
    .playas-footer {
      position: relative; z-index: 20;
      max-width: 1040px; margin: 3rem auto 0; padding: 1.5rem 2rem;
      font-family: var(--font-body); font-size: 0.55rem;
      letter-spacing: 0.3em; text-transform: uppercase; text-align: center;
      color: var(--accent-dim); opacity: 0.5; border-top: 1px solid var(--drawer-border);
    }
    .playas-empty {
      font-family: var(--font-body); font-size: 0.75rem;
      letter-spacing: 0.15em; color: var(--accent-dim);
      text-transform: uppercase; padding: 2rem 0;
    }

    /* ── Responsive ─────────────────────────────────────────── */
    @media (max-width: 600px) {
      .playas-hero { min-height: 0; padding: 4.5rem 1.2rem 1.5rem; }
      .playas-section { padding: 1.2rem 1rem 0; }
      .playas-grid { grid-template-columns: 1fr 1fr; gap: 0.8rem; }
      .playa-card { height: 400px; }
      .playa-card-inner { height: 400px; }
      .playa-name { font-size: 1.05rem; }
      .playas-footer { padding: 1.2rem 1rem; }
    }
    @media (max-width: 380px) {
      .playas-grid { grid-template-columns: 1fr; }
      .playa-card { height: 420px; }
      .playa-card-inner { height: 420px; }
    }
  </style>
</head>
<body>

  <!-- ── TOP NAV ─────────────────────────────────────────── -->
  <nav class="topnav" role="navigation" aria-label="Site navigation">
    <a href="index.html" class="topnav-logo">OFC</a>
    <button class="menu-trigger" aria-label="Open navigation menu" aria-expanded="false" aria-controls="site-drawer">
      <span></span><span></span><span></span>
    </button>
  </nav>

  <!-- ── DRAWER ──────────────────────────────────────────── -->
  <div class="drawer-overlay" aria-hidden="true"></div>
  <aside id="site-drawer" class="drawer" role="dialog" aria-modal="true" aria-label="Navigation">
    <p class="drawer-label">Navigate</p>
    <ul class="drawer-nav"></ul>
    <div class="drawer-footer"></div>
  </aside>

  <!-- ── PLAYAS PAGE ─────────────────────────────────────── -->
  <div class="playas-page" id="playasPage">

    <div class="slide-layer" id="slideA" aria-hidden="true"></div>
    <div class="slide-layer" id="slideB" aria-hidden="true"></div>
    <div class="landing-overlay" id="playasOverlay" aria-hidden="true"></div>
    <div class="landing-vignette" aria-hidden="true"></div>

    <header class="playas-hero" id="playasHero">
      <div class="landing-rule" aria-hidden="true"></div>
      <div class="playas-hero-content">
        <p class="playas-hero-eyebrow">Official Fantasy Commission</p>
        <h1 class="playas-hero-title">The Playas</h1>
        <p class="playas-hero-subtitle">The Roster</p>
      </div>
    </header>

    <div class="playas-body" id="playasBody"></div>

  </div>

  <script src="menu.js"></script>

  <script>
  (function () {
    'use strict';

    function esc(s) {
      return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    // ── Get championship entries for a member ──
    function getChampionships(memberId, leagueData) {
      var entries = [];
      (leagueData || []).forEach(function (league) {
        (league.seasons || []).forEach(function (season) {
          if (season.championMemberId && season.championMemberId === memberId) {
            entries.push({ year: season.year || '?', leagueName: league.name || '' });
          }
        });
      });
      entries.sort(function (a, b) { return (parseInt(b.year,10)||0) - (parseInt(a.year,10)||0); });
      return entries;
    }

    // ── Count total seasons played ──
    function countSeasons(memberId, leagueData) {
      var total = 0;
      (leagueData || []).forEach(function (league) {
        (league.seasons || []).forEach(function (season) {
          var inRoster    = (season.roster    || []).some(function (r) { return r.memberId === memberId; });
          var inStandings = (season.standings || []).some(function (r) { return r.memberId === memberId; });
          if (inRoster || inStandings) total++;
        });
      });
      return total;
    }

    // ── Get all non-championship awards won, sorted by year desc ──
    function getAwardsWon(memberId, leagueData) {
      var awards  = [];
      var schemas = window.SPORT_STAT_SCHEMAS || {};

      (leagueData || []).forEach(function (league) {
        var schema    = schemas[league.sport] || schemas.other || {};
        var awardDefs = schema.awards || [];

        (league.seasons || []).forEach(function (season) {
          var stats       = season.stats       || {};
          var customStats = season.customStats || [];

          // Schema-defined awards — skip champion
          awardDefs.forEach(function (a) {
            if (a.key === 'champion') return;
            var statDef = (schema.stats || []).find(function (s) { return s.awardKey === a.key; });
            var statKey = statDef ? statDef.key : a.key;
            var stat    = stats[statKey];
            if (!stat || stat.memberId !== memberId) return;
            awards.push({
              awardName:  (league.awards && league.awards[a.key]) || a.defaultLabel || a.key,
              awardImage: (league.awardImages && league.awardImages[a.key]) || '',
              year:       season.year || '?',
              leagueName: league.name || ''
            });
          });

          // Custom awards
          (league.customAwards || []).forEach(function (ca) {
            var entry = customStats.find(function (cs) { return cs.customAwardId === ca.id; });
            if (!entry || entry.memberId !== memberId) return;
            awards.push({
              awardName:  ca.label || 'Award',
              awardImage: ca.image || '',
              year:       season.year || '?',
              leagueName: league.name || ''
            });
          });
        });
      });

      awards.sort(function (a, b) { return (parseInt(b.year,10)||0) - (parseInt(a.year,10)||0); });
      return awards;
    }

    // ── Initials fallback ──
    function initials(name) {
      return (name || '?').split(' ').map(function (w) { return w[0]; }).join('').slice(0,2).toUpperCase();
    }

    // ── League badge HTML ──
    function buildLeagueBadges(member, leagueData) {
      return (member.leagues || []).map(function (lg) {
        var leagueObj = (leagueData || []).find(function (l) {
          return l.name === lg.leagueKey || l.name === lg.leagueName;
        });
        var logoSrc = leagueObj && leagueObj.logo ? leagueObj.logo : '';
        var keyText = lg.leagueKey || lg.leagueName || '?';
        var inner = logoSrc
          ? '<img src="' + esc(logoSrc) + '" alt="' + esc(keyText) + '" loading="lazy" />'
          : '<span class="playa-league-badge-text">' + esc(keyText) + '</span>';
        return '<div class="playa-league-badge" title="' + esc(keyText) + '">' + inner + '</div>';
      }).join('');
    }

    // ── Award thumbnail ──
    function awardThumbFront(imgSrc) {
      return imgSrc
        ? '<img class="playa-recent-award-img" src="' + esc(imgSrc) + '" alt="" loading="lazy" />'
        : '<div class="playa-recent-award-placeholder">&#9733;</div>';
    }
    function awardThumbBack(imgSrc) {
      return imgSrc
        ? '<img class="playa-back-award-img" src="' + esc(imgSrc) + '" alt="" loading="lazy" />'
        : '<div class="playa-back-award-placeholder">&#9733;</div>';
    }

    // ── Build one playa card ──
    function buildPlayaCard(member, leagueData, delay) {
      var championships = getChampionships(member.id, leagueData);
      var champCount    = championships.length;
      var seasons       = countSeasons(member.id, leagueData);
      var allAwards     = getAwardsWon(member.id, leagueData);
      var awardCount    = allAwards.length;
      var recentAwards  = allAwards.slice(0, 2);
      var isActive      = member.active !== false;

      // ── FRONT ──────────────────────────────────────────

      var mugshotHtml =
        '<div class="playa-mugshot-wrap">' +
          '<div class="playa-status-badge ' + (isActive ? 'active' : 'inactive') + '">' +
            (isActive ? 'Active' : 'Alumni') +
          '</div>' +
          (member.mugshot
            ? '<img src="' + esc(member.mugshot) + '" alt="' + esc(member.name) + '" loading="lazy" />'
            : '<div class="playa-mugshot-placeholder"><span class="playa-monogram">' + esc(initials(member.name)) + '</span></div>'
          ) +
        '</div>';

      var badgesHtml = '<div class="playa-league-badges">' + buildLeagueBadges(member, leagueData) + '</div>';

      // League entries for front
      var frontLeaguesHtml = (member.leagues || []).length
        ? '<div class="playa-leagues">' +
            (member.leagues || []).map(function (lg) {
              var keyText   = lg.leagueKey || lg.leagueName || '?';
              var labelText = (lg.leagueName && lg.leagueName !== lg.leagueKey) ? lg.leagueName : keyText;
              var teamsHtml = (lg.teams || []).map(function (t) {
                return '<span class="playa-team-item">' +
                  (t.logo ? '<img class="playa-team-logo" src="' + esc(t.logo) + '" alt="" loading="lazy" />' : '') +
                  '<span class="playa-team-name">' + esc(t.name || '—') + '</span>' +
                '</span>';
              }).join('');
              return '<div class="playa-league-entry">' +
                '<div class="playa-league-key">' + esc(labelText) + '</div>' +
                '<div class="playa-league-teams">' + (teamsHtml || '<span class="playa-team-name" style="opacity:0.4;">—</span>') + '</div>' +
              '</div>';
            }).join('') +
          '</div>'
        : '';


      var recentAwardsHtml = recentAwards.length
        ? '<div class="playa-recent-awards">' +
            recentAwards.map(function (a) {
              return '<div class="playa-recent-award-item">' +
                awardThumbFront(a.awardImage) +
                '<span class="playa-recent-award-name">' + esc(a.awardName) + '</span>' +
              '</div>';
            }).join('') +
          '</div>'
        : '';

      var statsHtml = (champCount > 0 || awardCount > 0 || seasons > 0)
        ? '<div class="playa-stats-strip">' +
            (champCount > 0 ? '<div class="playa-stat"><div class="playa-stat-value">' + champCount + '</div><div class="playa-stat-label">' + (champCount === 1 ? 'Title' : 'Titles') + '</div></div>' : '') +
            (awardCount > 0 ? '<div class="playa-stat"><div class="playa-stat-value">' + awardCount + '</div><div class="playa-stat-label">' + (awardCount === 1 ? 'Award' : 'Awards') + '</div></div>' : '') +
            (seasons    > 0 ? '<div class="playa-stat"><div class="playa-stat-value">' + seasons    + '</div><div class="playa-stat-label">' + (seasons    === 1 ? 'Season' : 'Seasons') + '</div></div>' : '') +
          '</div>'
        : '';

      var frontHtml =
        '<div class="playa-front">' +
          mugshotHtml +
          '<div class="playa-front-info">' +
            '<div class="playa-name-row">' +
              '<div class="playa-name">' + esc(member.name || 'Unknown') + '</div>' +
              badgesHtml +
            '</div>' +
            (member.nickname ? '<div class="playa-nickname">&ldquo;' + esc(member.nickname) + '&rdquo;</div>' : '') +
            frontLeaguesHtml +
          '</div>' +
          statsHtml +
          '<div class="playa-flip-hint">Details &rarr;</div>' +
        '</div>';

      // ── BACK ───────────────────────────────────────────



      // Championships
      var backChampsHtml = champCount > 0
        ? '<div>' +
            '<div class="playa-back-section-label">Championships (' + champCount + ')</div>' +
            '<div class="playa-back-champ-years">' +
            championships.map(function (c) {
              return '<span class="playa-back-champ-year">' + esc(c.year) + (c.leagueName ? ' ' + esc(c.leagueName) : '') + '</span>';
            }).join('') +
            '</div></div>'
        : '';

      // All awards — compiled: one row per unique award, years listed oldest→newest
      var compiledAwards = (function () {
        var map = [], keys = [];
        allAwards.forEach(function (a) {
          var key = a.awardName + '||' + a.awardImage;
          var idx = keys.indexOf(key);
          if (idx === -1) {
            keys.push(key);
            map.push({ awardName: a.awardName, awardImage: a.awardImage, years: [a.year] });
          } else {
            if (map[idx].years.indexOf(a.year) === -1) map[idx].years.push(a.year);
          }
        });
        // Sort each award's years oldest→newest
        map.forEach(function (entry) {
          entry.years.sort(function (a, b) { return (parseInt(a, 10) || 0) - (parseInt(b, 10) || 0); });
        });
        return map;
      })();
      var backAwardsHtml = compiledAwards.length
        ? '<div>' +
            '<div class="playa-back-section-label">Awards (' + compiledAwards.length + ')</div>' +
            '<div class="playa-back-awards">' +
            compiledAwards.map(function (a) {
              return '<div class="playa-back-award-row">' +
                awardThumbBack(a.awardImage) +
                '<div class="playa-back-award-info">' +
                  '<div class="playa-back-award-name">' + esc(a.awardName) + '</div>' +
                  '<div class="playa-back-award-detail">' + a.years.map(function (y) { return esc(y); }).join(', ') + '</div>' +
                '</div>' +
              '</div>';
            }).join('') +
            '</div></div>'
        : '';

      var backHtml =
        '<div class="playa-back">' +
          '<div class="playa-back-inner">' +
            '<div class="playa-back-header">' +
              '<div class="playa-back-name-group">' +
                '<div class="playa-back-name">' + esc(member.name || 'Unknown') + '</div>' +
                (member.nickname ? '<div class="playa-back-nickname">&ldquo;' + esc(member.nickname) + '&rdquo;</div>' : '') +
              '</div>' +
              '<span class="playa-back-close">&#x2715;</span>' +
            '</div>' +
            '<div class="playa-back-scroll">' +
              backChampsHtml +
              backAwardsHtml +
              (!backChampsHtml && !backAwardsHtml
                ? '<p style="font-size:0.62rem;color:var(--accent-dim);opacity:0.5;">No data yet.</p>' : '') +
            '</div>' +
          '</div>' +
        '</div>';

      // ── Assemble ──────────────────────────────────────
      var card = document.createElement('div');
      card.className = 'playa-card section-reveal' + (isActive ? '' : ' is-inactive');
      card.style.animationDelay = delay + 's';
      card.innerHTML = '<div class="playa-card-inner">' + frontHtml + backHtml + '</div>';

      card.addEventListener('click', function (e) {
        if (e.target.classList.contains('playa-back-close')) {
          card.classList.remove('is-flipped');
        } else {
          card.classList.toggle('is-flipped');
        }
      });

      return card;
    }

    // ── Sort ──
    function mostRecentSeasonYear(memberId, leagueData) {
      var best = 0;
      (leagueData || []).forEach(function (league) {
        (league.seasons || []).forEach(function (season) {
          var inRoster    = (season.roster    || []).some(function (r) { return r.memberId === memberId; });
          var inStandings = (season.standings || []).some(function (r) { return r.memberId === memberId; });
          if (inRoster || inStandings) best = Math.max(best, parseInt(season.year, 10) || 0);
        });
      });
      return best;
    }

    function mostRecentAwardYear(memberId, leagueData) {
      var awards = getAwardsWon(memberId, leagueData); // already sorted desc
      return awards.length ? (parseInt(awards[0].year, 10) || 0) : 0;
    }

    function sortMembers(members, leagueData, mode) {
      return members.slice().sort(function (a, b) {
        if (mode === 'titles') {
          var aC = getChampionships(a.id, leagueData);
          var bC = getChampionships(b.id, leagueData);
          if (bC.length !== aC.length) return bC.length - aC.length;
          var aYear = aC.length ? (parseInt(aC[0].year, 10) || 0) : 0;
          var bYear = bC.length ? (parseInt(bC[0].year, 10) || 0) : 0;
          if (bYear !== aYear) return bYear - aYear;
          return (a.name || '').localeCompare(b.name || '');
        }
        if (mode === 'awards') {
          var aA = getAwardsWon(a.id, leagueData).length;
          var bA = getAwardsWon(b.id, leagueData).length;
          if (bA !== aA) return bA - aA;
          var aAY = mostRecentAwardYear(a.id, leagueData);
          var bAY = mostRecentAwardYear(b.id, leagueData);
          if (bAY !== aAY) return bAY - aAY;
          return (a.name || '').localeCompare(b.name || '');
        }
        if (mode === 'seasons') {
          var aS = countSeasons(a.id, leagueData);
          var bS = countSeasons(b.id, leagueData);
          if (bS !== aS) return bS - aS;
          var aSY = mostRecentSeasonYear(a.id, leagueData);
          var bSY = mostRecentSeasonYear(b.id, leagueData);
          if (bSY !== aSY) return bSY - aSY;
          return (a.name || '').localeCompare(b.name || '');
        }
        // A-Z
        return (a.name || '').localeCompare(b.name || '');
      });
    }

    // ── Render body ──
    function renderBody(config) {
      var body    = document.getElementById('playasBody');
      var roster  = config.masterRoster || [];
      var leagues = config.leagueData   || [];

      if (!roster.length) {
        body.innerHTML = '<div class="playas-section"><p class="playas-empty">No members in the roster yet.</p></div>';
        return;
      }

      // Build section container
      var sec = document.createElement('div');
      sec.className = 'playas-section section-reveal';
      sec.style.animationDelay = '0.5s';

      // ── Controls row ──
      var controlsRow = document.createElement('div');
      controlsRow.className = 'playas-controls-row';
      controlsRow.innerHTML =
        '<div class="playas-controls-left">' +
          '<span class="playas-heading-text">Active Roster</span>' +
          '<span class="playas-heading-count"></span>' +
        '</div>' +
        '<div class="playas-controls-right">' +
          '<div class="playas-control-group">' +
            '<label class="playas-control-label">Filter</label>' +
            '<select class="playas-select" id="playasFilter">' +
              '<option value="career">Career</option>' +
              '<option value="ofc">OFC</option>' +
              '<option value="brc">BRC</option>' +
              '<option value="retired">Retired</option>' +
            '</select>' +
          '</div>' +
          '<div class="playas-control-group">' +
            '<label class="playas-control-label">Sort</label>' +
            '<select class="playas-select" id="playasSort">' +
              '<option value="az">A–Z</option>' +
              '<option value="seasons">Seasons</option>' +
              '<option value="awards">Awards</option>' +
              '<option value="titles">Titles</option>' +
            '</select>' +
          '</div>' +
        '</div>';
      sec.appendChild(controlsRow);

      // ── Grid container ──
      var gridWrap = document.createElement('div');
      gridWrap.id = 'playasGridWrap';
      sec.appendChild(gridWrap);

      body.appendChild(sec);

      // ── Footer ──
      var footer = document.createElement('div');
      footer.className = 'playas-footer section-reveal';
      footer.id = 'playasFooter';
      if (config.footer && config.footer.show) {
        footer.textContent = config.footer.text;
      } else {
        footer.style.display = 'none';
      }
      body.appendChild(footer);

      // ── Render grid based on current filter + sort ──
      function applyFilterSort() {
        var filterVal = document.getElementById('playasFilter').value;
        var sortVal   = document.getElementById('playasSort').value;
        var wrap      = document.getElementById('playasGridWrap');
        var heading   = controlsRow.querySelector('.playas-heading-text');
        var countEl   = controlsRow.querySelector('.playas-heading-count');

        wrap.innerHTML = '';

        // Determine member set based on filter
        var active   = roster.filter(function (m) { return m.active !== false; });
        var inactive = roster.filter(function (m) { return m.active === false; });

        function inLeague(member, key) {
          return (member.leagues || []).some(function (lg) {
            return (lg.leagueKey || '').toUpperCase() === key.toUpperCase();
          });
        }

        var members;
        if (filterVal === 'career') {
          heading.textContent = 'Career';
          members = roster.slice();
        } else if (filterVal === 'ofc') {
          heading.textContent = 'OFC';
          members = roster.filter(function (m) { return inLeague(m, 'OFC'); });
        } else if (filterVal === 'brc') {
          heading.textContent = 'BRC';
          members = roster.filter(function (m) { return inLeague(m, 'BRC'); });
        } else if (filterVal === 'retired') {
          heading.textContent = 'Retired';
          members = inactive.slice();
        } else {
          members = roster.slice();
        }

        var sorted = sortMembers(members, leagues, sortVal);
        countEl.textContent = '— ' + sorted.length + ' Member' + (sorted.length !== 1 ? 's' : '');

        if (sorted.length) {
          var flatGrid = document.createElement('div');
          flatGrid.className = 'playas-grid';
          sorted.forEach(function (m, i) {
            flatGrid.appendChild(buildPlayaCard(m, leagues, 0.1 * i));
          });
          wrap.appendChild(flatGrid);
        } else {
          wrap.innerHTML = '<p class="playas-empty">No members match this filter.</p>';
        }

        // Update footer delay
        var footerEl = document.getElementById('playasFooter');
        if (footerEl) footerEl.style.animationDelay = '0.5s';
      }

      document.getElementById('playasFilter').addEventListener('change', applyFilterSort);
      document.getElementById('playasSort').addEventListener('change', applyFilterSort);

      applyFilterSort();
    }

    function initPlayasSlideshow(config) {
      var overlayEl = document.getElementById('playasOverlay');
      if (overlayEl && config.slideshow && config.slideshow.overlay) {
        overlayEl.style.background = config.slideshow.overlay;
      }
    }

    function init() {
      var config = window.SITE_CONFIG;
      if (!config) { console.warn('SITE_CONFIG not found'); return; }
      document.title = 'OFL \u2014 The Playas';
      initPlayasSlideshow(config);
      renderBody(config);
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

  })();
  </script>

</body>
</html>
